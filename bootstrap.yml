- hosts: web
  gather_facts: false
  tasks:
    - name: Wait for SSH connection with retries
      wait_for_connection:
        timeout: 30
        delay: 5
        connect_timeout: 5
      retries: 20
      until: result is succeeded
      register: result
  
    - authorized_key:
        user: root
        key: "{{ lookup('file', '/root/.ssh/id_ed25519.pub') }}"
